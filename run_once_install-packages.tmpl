#!/bin/sh

{{ if eq .chezmoi.osRelease.id "arch" "manjaro" -}}
aur_install() {
    git clone "$1" $HOME/.aur_install
    cd $HOME/.aur_install
    makepkg --clean --install --syncdeps --noconfirm
    cd $HOME
    rm -rfd $HOME/.aur_install
}
sudo pacman -S --needed ripgrep bash git fd fzf exa fish bat yarn fakeroot binutils
yarn global add @fabiospampinato/bump
aur_install https://aur.archlinux.org/starship-bin.git
aur_install https://aur.archlinux.org/asdf-vm.git
{{ end -}}

{{ if eq .chezmoi.osRelease.id "fedora" -}}
sudo dnf module -y disable fish
sudo dnf distro-sync fish
sudo dnf install bash git ripgrep fd-find exa fish npm bat bash fzf findutils
npm install -g yarn
yarn global add @fabiospampinato/bump
curl -fsSL https://starship.rs/install.sh | bash -s -- -y
{{ end -}}

{{ if eq .chezmoi.osRelease.id "ubuntu" "debian" -}}
apt_or_git() {
    sudo apt-get install $1 \
    || (
            curl -o $HOME/.curled_package -LO $2 \
            && sudo dpkg -i --force-overwrite $HOME/.curled_package
            rm $HOME/.curled_package
        )
}

sudo apt-get install git bash fish npm curl unzip
npm install -g yarn
yarn global add @fabiospampinato/bump
curl -fsSL https://starship.rs/install.sh | bash -s -- -y
curl -o $HOME/exa -LO https://github.com/ogham/exa/releases/download/v0.9.0/exa-linux-x86_64-0.9.0.zip \
&& sudo unzip $HOME/exa -d $HOME && sudo mv $HOME/exa-linux-x86_64 /usr/bin/exa && rm -rf $HOME/exa

apt_or_git fd-find https://github.com/sharkdp/fd/releases/download/v8.0.0/fd-musl_8.0.0_amd64.deb
apt_or_git ripgrep https://github.com/BurntSushi/ripgrep/releases/download/11.0.2/ripgrep_11.0.2_amd64.deb
apt_or_git bat https://github.com/sharkdp/bat/releases/download/v0.13.0/bat_0.13.0_amd64.deb

sudo apt-get install fzf \
|| (git clone --depth 1 https://github.com/junegunn/fzf.git $HOME/.fzf && $HOME/.fzf/install --no-bash --no-zsh --all --64)
{{ end -}}

{{ if ne .chezmoi.osRelease.id "arch" -}}
{{ if ne .chezmoi.osRelease.id "manjaro" -}}
git clone https://github.com/asdf-vm/asdf.git $HOME/.asdf
git --git-dir=$HOME/.asdf/.git checkout $(git --git-dir=$HOME/.asdf/.git describe --abbrev=0 --tags)
{{ end -}}
{{ end -}}
